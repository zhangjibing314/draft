---
title: linux 中 设备和设备驱动的关系
toc: true
---

# 新设备插入时会发生什么?(USB 设备)
## 硬件检测
* 电气检测：USB 控制器检测到热插拔事件，触发硬件中断；
* 总线枚举：和设备交互，收集基本信息；
## 内核处理
* 触发中段，USB子系统的中断处理函数被调用，开始设备初始化流程；
* USB系统与设备交互
    * 为新设备分配地址
    * 读取设备基本描述
    * 读取配置描述信息
    * 选择配置
## 加载驱动程序
* 根据设备描述符（特别是 VID 和 PID）查找合适的驱动程序
* 将找到的驱动程序和设备绑定
## 创建设备节点
* 内核发送事件通知用户空间的udev守护进程；
* udev根据规则和信息创建设备文件
* 如果设备可用还可触发挂载
# linux 的热插拔过程是什么样的？
## 插入新设备
* 触发中断
* 内核检测到新设备
    * 收集必要硬件信息
    * 创建内核结构体，收集必要硬件信息并初始化该结构体;
    * 匹配设备驱动
    * 注册设备
    * 向用户态守护进程 udev 发送事件通知
* udev 监听到内核时间，创建设备文件
